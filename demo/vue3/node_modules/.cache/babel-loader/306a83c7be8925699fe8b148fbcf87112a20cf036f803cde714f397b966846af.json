{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, watchEffect, computed, onMounted } from \"vue\";\nimport { EditPen, List, UploadFilled, Operation, Histogram, CircleCheckFilled, Flag } from \"@element-plus/icons-vue\";\nimport SelectMethod from \"@/components/SelectMethod.vue\";\nimport ViewResult from \"@/components/ViewResult.vue\";\nimport { uploadVideo, uploadTranscript } from \"@/api/upload\";\nimport OperationMethod from \"@/utils/operation.js\";\nimport { callASR } from \"@/api/detection\";\nimport { videoEditAligned, getFileFromUrl } from \"@/api/modify\";\nimport { ElLoading, ElMessage } from \"element-plus\";\nimport { runMSAAligned } from \"@/api/detection\";\nexport default {\n  __name: 'VideoEditor',\n  setup(__props, {\n    expose\n  }) {\n    expose();\n    const currentFile = ref(\"\");\n    const McurrentFile = ref(\"\");\n    const currentVideoUrl = ref(\"\");\n    const McurrentVideoUrl = ref(\"\");\n    const activeStep = ref(2);\n    const modifiedVideoTime = ref(0);\n    const modifiedWavesurfer = ref(null);\n    const duration = ref(0);\n    const originalID = ref(\"\");\n    const originalPath = ref(\"\");\n    const textarea = ref(\"\");\n    const arrayTitle = ref(\"\");\n    const showPositionTop = ref(0);\n    const showPositionLeft = ref(0);\n    const affixStatus = ref(true);\n    const dialogReplaceTitle = ref(\"\");\n    const alternateText = ref(\"\");\n    const rightPopup = ref(false);\n    const editAlignedIndex = ref(-1);\n    const methodList = ref({\n      defence: [],\n      models: [\"MMIN\", \"TFR_Net\", \"T2FN\", \"TPFN\"]\n    });\n    const overTooltip = ref({\n      replace: false,\n      remove: false,\n      blank: false,\n      gblur: false,\n      mute: false,\n      noise_white: false\n    });\n    const modalityDisplay = ref({\n      video: false,\n      audio: false,\n      text: false,\n      gblur: false,\n      clear: false\n    });\n    const dragDisplay = ref({\n      video: true,\n      audio: true,\n      text: true,\n      noise: true\n    });\n    const gblurValue = ref(\"low\");\n    const gblurOptions = ref([{\n      value: \"low\",\n      label: \"Low\"\n    }, {\n      value: \"medium\",\n      label: \"Medium\"\n    }, {\n      value: \"high\",\n      label: \"High\"\n    }]);\n    const modifiedPlayer = ref(null);\n    const modifiedWaveform = ref(null);\n    const noiseObj = ref({\n      white: 0,\n      metro: 0,\n      office: 0,\n      park: 0,\n      diner: 0,\n      traffic: 0\n    });\n    const upload = ref(\"\");\n    const dialogReplaceText = ref(false);\n    const triangleTop = ref(0);\n    const triangleLeft = ref(0);\n    const tooltipTop = ref(0);\n    const tooltipLeft = ref(0);\n    const viewResults = ref(null);\n    const methodData = ref(null);\n    const modifiedTextList = ref([{\n      conf: 0.9924983864489116,\n      end: 0.25155598958333336,\n      start: 0.05031119791666667,\n      text: \"now\"\n    }, {\n      conf: 0.7846563020477458,\n      end: 0.4729252604166667,\n      start: 0.25155598958333336,\n      text: \"the\"\n    }, {\n      conf: 0.6531528330428251,\n      end: 0.8351658854166667,\n      start: 0.4729252604166667,\n      text: \"title\"\n    }, {\n      conf: 0.47641091293124294,\n      end: 1.0766596354166666,\n      start: 0.8351658854166667,\n      text: \"of\"\n    }, {\n      conf: 0.24061251992673066,\n      end: 1.1974065104166667,\n      start: 1.0766596354166666,\n      text: \"the\"\n    }, {\n      conf: 0.5447095983243366,\n      end: 1.4590247395833333,\n      start: 1.1974065104166667,\n      text: \"movie\"\n    }, {\n      conf: 0.6084983060602999,\n      end: 1.8212653645833332,\n      start: 1.4590247395833333,\n      text: \"baseke\"\n    }, {\n      conf: 0.6754744243939316,\n      end: 2.0426346354166665,\n      start: 1.8212653645833332,\n      text: \"sets\"\n    }, {\n      conf: 0.47667267739500935,\n      end: 2.14325703125,\n      start: 2.0426346354166665,\n      text: \"it\"\n    }, {\n      conf: 0.6783241011170195,\n      end: 2.3646263020833334,\n      start: 2.14325703125,\n      text: \"all\"\n    }]);\n    const editAligned = ref([]);\n    const form = ref({\n      name: \"\"\n    });\n    const defenceVideoUrl = ref(\"\");\n    const regions = computed(() => {\n      let dataList = [];\n      modifiedTextList.value.forEach(item => {\n        let itemdata = {\n          start: 0,\n          end: 0,\n          attributes: {\n            label: \"\"\n          },\n          data: {\n            note: \"\"\n          },\n          loop: false,\n          drag: false,\n          resize: false,\n          color: \"rgba(181, 198, 241, 0.2)\",\n          handleStyle: false\n        };\n        itemdata.start = item.start;\n        itemdata.end = item.end;\n        dataList.push(itemdata);\n      });\n      return dataList;\n    });\n    const modifiedWaveformSwitch = ref(true);\n    const addVideoModified = files => {\n      McurrentFile.value = files;\n    };\n    const uploadMp4 = async (file, fileList) => {\n      if (file.status === \"ready\") {\n        const is10M = file.size / 1024 / 1024 < 10;\n        if (is10M) {\n          currentFile.value = file.raw;\n        } else {\n          ElMessage({\n            message: \"Uploaded file should be no more than 10MB.\",\n            type: \"warning\"\n          });\n        }\n        upload.value.clearFiles();\n      }\n    };\n    const modifiedEvent = () => {\n      modifiedWavesurfer.value = OperationMethod.waveformCreate(modifiedWaveform.value, regions.value);\n      modifiedWavesurfer.value.load(McurrentVideoUrl.value);\n      modifiedWavesurfer.value.on(\"ready\", () => {\n        OperationMethod.dragBackgroundColor(editAligned.value, modifiedTextList.value.length);\n      });\n    };\n    const nextButton = async index => {\n      if (index == 1) {\n        if (typeof currentFile.value == \"undefined\" || currentFile.value == \"\") {\n          ElMessage({\n            message: \"Please select a file.\",\n            type: \"warning\"\n          });\n          return;\n        }\n        let result = await uploadFile(currentFile.value);\n        if (result.code === 200) {\n          // McurrentVideoUrl.value = `${window.static_url}/${result.id}/raw_video.mp4`;\n          try {\n            var response = await getFileFromUrl(`${result.id}/raw_video.mp4`, \"raw_video.mp4\");\n            // this.McurrentVideoUrl = `${window.static_url}/${result.id}/raw_video.mp4`\n            McurrentVideoUrl.value = URL.createObjectURL(response);\n          } catch (error) {\n            return;\n          }\n          originalID.value = result.id;\n          originalPath.value = result.path;\n          let ASRResult = await ASRClick(result.id);\n          if (ASRResult.code != 200) {\n            return;\n          }\n          try {\n            var response = await getFileFromUrl(`${result.id}/raw_video.mp4`, \"raw_video.mp4\");\n          } catch (error) {\n            return;\n          }\n          duration.value = (await OperationMethod.getVideoDuration(response)) / 1000000;\n          addVideoModified([response]);\n        } else {\n          return;\n        }\n        // addVideoModified([currentFile.value]);\n        // duration.value = 12.3;\n      } else if (index == 2) {\n        if (textarea.value) {\n          if (/\\d/.test(textarea.value)) {\n            ElMessage({\n              message: \"Please substitute numbers with text\",\n              type: \"warning\"\n            });\n            return;\n          }\n          const loading = ElLoading.service({\n            lock: true,\n            text: \"Aligning video with transcript...\"\n          });\n          try {\n            var result = await uploadTranscript({\n              videoID: originalID.value,\n              transcript: textarea.value\n            });\n            loading.close();\n          } catch (error) {\n            loading.close();\n            return;\n          }\n          modifiedTextList.value = result.data.align;\n          currentVideoUrl.value = McurrentVideoUrl.value;\n        }\n        setTimeout(() => {\n          modifiedEvent();\n        }, 5);\n      } else if (index == 3) {\n        if (McurrentVideoUrl.value === currentVideoUrl.value) {\n          ElMessage({\n            message: \"After modifying the video, please click generate.\",\n            type: \"warning\"\n          });\n          return;\n        }\n      } else if (index == 4) {\n        if (methodList.value.models.length == 0) {\n          ElMessage({\n            message: \"Please select at least one msa model.\",\n            type: \"warning\"\n          });\n          return;\n        } else {\n          methodData.value = methodList.value;\n          methodData.value[\"videoID\"] = originalID.value;\n          const loading = ElLoading.service({\n            lock: true,\n            text: \"Processing, please wait...\"\n          });\n          try {\n            let result = await runMSAAligned(methodData.value);\n            defenceVideoUrl.value = await getFileFromUrl(`${originalID.value}/defended_video.mp4`, \"defended_video.mp4\");\n            defenceVideoUrl.value = URL.createObjectURL(defenceVideoUrl.value);\n            viewResults.value = result.data;\n            loading.close();\n          } catch (error) {\n            loading.close();\n            return;\n          }\n        }\n      }\n      activeStep.value++;\n    };\n    const uploadFile = async file => {\n      const loading = ElLoading.service({\n        lock: true,\n        text: \"Video uploading, please wait...\"\n      });\n      let data = new FormData();\n      data.append(\"video\", file);\n      try {\n        var result = await uploadVideo(data);\n      } catch (error) {\n        return {\n          code: 400\n        };\n      } finally {\n        loading.close();\n      }\n      return result.data;\n    };\n    const ASRClick = async originalID => {\n      const loading = ElLoading.service({\n        lock: true,\n        text: \"Speech Recognition in progress...\"\n      });\n      try {\n        const ASRResult = await callASR({\n          videoID: originalID\n        });\n        textarea.value = ASRResult.data.result;\n      } catch (error) {\n        return {\n          code: 400\n        };\n      } finally {\n        loading.close();\n      }\n      return {\n        code: 200\n      };\n    };\n    const watchVideo = videoTime => {\n      if (videoTime > modifiedTextList.value[modifiedTextList.value.length - 1].end) {\n        OperationMethod.hightLightInit();\n        return OperationMethod.dragBackgroundColor(editAligned.value, modifiedTextList.value.length);\n      }\n      let watchSwitch = true;\n      for (let index = 0; index < modifiedTextList.value.length; index++) {\n        if (modifiedTextList.value[index].start < videoTime && videoTime <= modifiedTextList.value[index].end) {\n          OperationMethod.highlightOver(index - 1, \"rgba(181, 198, 241, 0.2)\", \"#fff\");\n          OperationMethod.highlightOver(index, \"rgba(255, 228, 196, 0.5)\", \"rgba(255, 228, 196, 0.5)\");\n          OperationMethod.dragBackgroundColor(editAligned.value, modifiedTextList.value.length);\n          watchSwitch = false;\n          break;\n        }\n      }\n      if (watchSwitch) {\n        OperationMethod.hightLightInit();\n        OperationMethod.dragBackgroundColor(editAligned.value, modifiedTextList.value.length);\n      }\n    };\n    const modifiedVideoTimeEvent = that => {\n      let count = 10;\n      let timer = setInterval(() => {\n        modifiedVideoTime.value = that.currentTime();\n        modifiedWavesurfer.value.seekAndCenter(modifiedVideoTime.value / duration.value > 1 ? 1 : modifiedVideoTime.value / duration.value);\n        watchVideo(modifiedVideoTime.value);\n        count == 0 ? clearInterval(timer) : count--;\n      }, 25);\n    };\n    const seekToTime = textitem => {\n      if (textitem == null) {\n        setTimeout(() => {\n          modifiedPlayer.value.currentTime(modifiedWavesurfer.value.getCurrentTime() + 0.000001);\n        }, 5);\n      } else {\n        modifiedPlayer.value.currentTime(textitem + 0.000001);\n      }\n    };\n    const dragEnd = (e, type, method, lastkey) => {\n      var element = document.elementFromPoint(e.clientX, e.clientY);\n      if ($(element).parent().attr(\"class\") == \"textContent\") {\n        editAlignedIndex.value = Number($(element).attr(\"id\"));\n        editAligned.value = editAligned.value.filter(item => {\n          return !(item[0] == editAlignedIndex.value && item[1] == type && item[2] == method);\n        });\n        let item = [editAlignedIndex.value, type, method, lastkey];\n        if (method == \"replace\") {\n          dialogReplaceText.value = true;\n          dialogReplaceTitle.value = modifiedTextList.value[editAlignedIndex.value].text;\n          return;\n        }\n        editAligned.value.push(item);\n        OperationMethod.dragBackgroundColor(editAligned.value, modifiedTextList.value.length);\n      }\n    };\n    const dragOver = e => {\n      e.preventDefault();\n      e.dataTransfer.dropEffect = \"move\";\n    };\n    const modifiedWaveAudeo = () => {\n      modifiedPlayer.value = videojs(\"modified-my-player\", {}, function onPlayerReady() {\n        this.on(\"play\", function (e) {\n          modifiedVideoTimeEvent(this);\n        });\n        this.on(\"timeupdate\", function (e) {\n          modifiedVideoTimeEvent(this);\n        });\n        this.on(\"seeked\", function () {\n          OperationMethod.hightLightInit();\n        });\n      });\n    };\n    watchEffect(() => {\n      if (activeStep.value == 2) {\n        let player = videojs.getPlayer(\"modified-my-player\");\n        if (player) {\n          player.dispose();\n        }\n        modifiedWaveAudeo();\n      }\n    }, {\n      flush: \"post\"\n    });\n    const sliderInput = e => {\n      editAligned.value = OperationMethod.modifyCard(editAligned.value, noiseObj.value, modifiedTextList.value.length);\n    };\n    watchEffect(() => {\n      OperationMethod.dragBackgroundColor(editAligned.value, modifiedTextList.value.length);\n    });\n    const mouseDown = e => {\n      var state = true;\n      try {\n        e.path.forEach(item => {\n          if ($(item).attr(\"id\") == \"popup\") {\n            state = false;\n          }\n        });\n      } catch (error) {\n        return;\n      }\n      if (state && modifiedTextList.value.length) {\n        rightPopup.value = false;\n        OperationMethod.hightLightInit();\n        OperationMethod.dragBackgroundColor(editAligned.value, modifiedTextList.value.length);\n      }\n    };\n    const dialogConfirm = () => {\n      dialogReplaceText.value = false;\n      rightPopup.value = false;\n      let item = [editAlignedIndex.value, \"t\", \"replace\", alternateText.value];\n      editAligned.value.push(item);\n      OperationMethod.dragBackgroundColor(editAligned.value, modifiedTextList.value.length);\n    };\n    const textOver = async (e, index, background, textBackground) => {\n      if (!rightPopup.value) {\n        await OperationMethod.highlightOver(index, background, textBackground);\n      }\n      OperationMethod.dragBackgroundColor(editAligned.value, modifiedTextList.value.length);\n      overTooltip.value = {\n        replace: false,\n        remove: false,\n        blank: false,\n        gblur: false,\n        mute: false,\n        noise_white: false\n      };\n      if (textBackground != \"#fff\") {\n        editAligned.value.forEach(item => {\n          if (item[0] == index) {\n            overTooltip.value[item[2] == \"noise-white\" ? \"noise_white\" : item[2]] = true;\n          }\n        });\n        triangleTop.value = $(`#${index}`).offset().top + $(`#${index}`).height();\n        tooltipTop.value = triangleTop.value + 8;\n        triangleLeft.value = $(`#${index}`).offset().left + $(`#${index}`).width() / 2 - 5 - $(`.appContainer`).offset().left;\n        tooltipLeft.value = triangleLeft.value - 40;\n        setTimeout(() => {\n          tooltipLeft.value = triangleLeft.value - $(`.ztooltip`).width() / 2 + 2;\n        }, 1);\n      }\n    };\n    const waveOver = async (e, waveBackground, textBackground) => {\n      if (e.target.getAttributeNode(\"class\") && e.target.getAttributeNode(\"class\").value === \"wavesurfer-region\" && !rightPopup.value) {\n        let index = $(`#modifiedWaveform > wave > region.wavesurfer-region`).index(e.target);\n        await OperationMethod.highlightOver(index, waveBackground, textBackground);\n      }\n      OperationMethod.dragBackgroundColor(editAligned.value, modifiedTextList.value.length);\n    };\n    const rightClickItem = async (e, type) => {\n      const element = document.getElementById(`${e.target.id}`);\n      showPositionTop.value = element.offsetTop + 80 || 0;\n      showPositionLeft.value = element.offsetLeft + element.offsetWidth + 25 || 0;\n      rightPopup.value = true;\n      await OperationMethod.hightLightInit();\n      let index = $(type == \"wave\" ? \"#modifiedWaveform > wave > region.wavesurfer-region\" : \".pageContainer .modifiedCon .textContent span\").index(e.target);\n      editAligned.value.index = index;\n      await OperationMethod.highlightOver(index, \"rgba(255, 228, 196, 0.5)\", \"rgba(255, 228, 196, 0.5)\");\n      modalityDisplay.value.clear = false;\n      editAligned.value.forEach(item => {\n        if (item[0] == index) {\n          modalityDisplay.value.clear = true;\n        }\n      });\n      modalityDisplay.value.clear = noiseObj.value.white || noiseObj.value.metro || noiseObj.value.office || noiseObj.value.park || noiseObj.value.diner || noiseObj.value.traffic || modalityDisplay.value.clear ? true : false;\n    };\n    const generate = async () => {\n      if (editAligned.value.length == 0) {\n        ElMessage({\n          message: \"Please modify the video first.\",\n          type: \"warning\"\n        });\n        return;\n      }\n      let data = {\n        videoID: originalID.value,\n        words: editAligned.value\n      };\n      const loading = ElLoading.service({\n        lock: true,\n        text: \"Generating modified video...\"\n      });\n      try {\n        var result = await videoEditAligned(data);\n      } catch (error) {\n        loading.close();\n        return;\n      }\n      if (result.data.code == 200) {\n        McurrentFile.value = \"\";\n        try {\n          var response = await getFileFromUrl(`${originalID.value}/modified_video.mp4`, \"modified_video.mp4\");\n          McurrentVideoUrl.value = URL.createObjectURL(response);\n        } catch (error) {\n          loading.close();\n          return;\n        }\n        addVideoModified([response]);\n        modifiedPlayer.value.dispose();\n        let html = '<video id=\"modified-my-player\" class=\"video-js vjs-big-play-centered\" controls=\"true\"><source src=\"' + McurrentVideoUrl.value + '\" type=\"video/mp4\" /></video>';\n        document.getElementById(\"modifiedContainer\").innerHTML = html;\n        modifiedWaveAudeo();\n        modifiedWaveformSwitch.value = false;\n        setTimeout(() => {\n          modifiedWaveformSwitch.value = true;\n          setTimeout(() => {\n            modifiedEvent();\n          }, 2);\n        }, 2);\n        editAligned.value.forEach(item => {\n          if (item[1] == \"t\") {\n            if (item[2] == \"replace\") {\n              modifiedTextList.value[item[0]].text = item[3];\n            } else {\n              modifiedTextList.value[item[0]].text = \"[REMOVED]\";\n            }\n          }\n        });\n        loading.close();\n      }\n    };\n    const modalityModify = (e, t, last = \"\") => {\n      OperationMethod.hightLightInit();\n      let edit_aligned = editAligned.value.filter(item => {\n        return item[0] == editAligned.value.index && (item[1] == t || \"all\" == t) ? false : true;\n      });\n      if (e != \"clear\") {\n        let lastkey = \"\";\n        if (t == \"v\") {\n          lastkey = e == \"gblur\" ? last : \"\";\n        } else if (t == \"a\") {\n          lastkey = e == \"noise-white\" ? \"low\" : \"\";\n        } else if (e == \"replace\") {\n          dialogReplaceText.value = true;\n          dialogReplaceTitle.value = modifiedTextList.value[editAligned.value.index].text;\n          return;\n        }\n        let item = [editAligned.value.index, t, e, lastkey];\n        edit_aligned.push(item);\n      } else {\n        edit_aligned = [];\n        noiseObj.value = {\n          white: 0,\n          metro: 0,\n          office: 0,\n          park: 0,\n          diner: 0,\n          traffic: 0\n        };\n        OperationMethod.dragBackgroundColor(edit_aligned, modifiedTextList.value.length);\n      }\n      editAligned.value = edit_aligned;\n      rightPopup.value = false;\n    };\n    onMounted(() => {\n      window.addEventListener(\"mousedown\", mouseDown);\n      arrayTitle.value = $(\".elSteps\").width() + 5;\n    });\n    const __returned__ = {\n      currentFile,\n      McurrentFile,\n      currentVideoUrl,\n      McurrentVideoUrl,\n      activeStep,\n      modifiedVideoTime,\n      modifiedWavesurfer,\n      duration,\n      originalID,\n      originalPath,\n      textarea,\n      arrayTitle,\n      showPositionTop,\n      showPositionLeft,\n      affixStatus,\n      dialogReplaceTitle,\n      alternateText,\n      rightPopup,\n      editAlignedIndex,\n      methodList,\n      overTooltip,\n      modalityDisplay,\n      dragDisplay,\n      gblurValue,\n      gblurOptions,\n      modifiedPlayer,\n      modifiedWaveform,\n      noiseObj,\n      upload,\n      dialogReplaceText,\n      triangleTop,\n      triangleLeft,\n      tooltipTop,\n      tooltipLeft,\n      viewResults,\n      methodData,\n      modifiedTextList,\n      editAligned,\n      form,\n      defenceVideoUrl,\n      regions,\n      modifiedWaveformSwitch,\n      addVideoModified,\n      uploadMp4,\n      modifiedEvent,\n      nextButton,\n      uploadFile,\n      ASRClick,\n      watchVideo,\n      modifiedVideoTimeEvent,\n      seekToTime,\n      dragEnd,\n      dragOver,\n      modifiedWaveAudeo,\n      sliderInput,\n      mouseDown,\n      dialogConfirm,\n      textOver,\n      waveOver,\n      rightClickItem,\n      generate,\n      modalityModify,\n      ref,\n      watchEffect,\n      computed,\n      onMounted,\n      get EditPen() {\n        return EditPen;\n      },\n      get List() {\n        return List;\n      },\n      get UploadFilled() {\n        return UploadFilled;\n      },\n      get Operation() {\n        return Operation;\n      },\n      get Histogram() {\n        return Histogram;\n      },\n      get CircleCheckFilled() {\n        return CircleCheckFilled;\n      },\n      get Flag() {\n        return Flag;\n      },\n      SelectMethod,\n      ViewResult,\n      get uploadVideo() {\n        return uploadVideo;\n      },\n      get uploadTranscript() {\n        return uploadTranscript;\n      },\n      get OperationMethod() {\n        return OperationMethod;\n      },\n      get callASR() {\n        return callASR;\n      },\n      get videoEditAligned() {\n        return videoEditAligned;\n      },\n      get getFileFromUrl() {\n        return getFileFromUrl;\n      },\n      get ElLoading() {\n        return ElLoading;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get runMSAAligned() {\n        return runMSAAligned;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"mappings":"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","names":["ref","watchEffect","computed","onMounted","EditPen","List","UploadFilled","Operation","Histogram","CircleCheckFilled","Flag","SelectMethod","ViewResult","uploadVideo","uploadTranscript","OperationMethod","callASR","videoEditAligned","getFileFromUrl","ElLoading","ElMessage","runMSAAligned","currentFile","McurrentFile","currentVideoUrl","McurrentVideoUrl","activeStep","modifiedVideoTime","modifiedWavesurfer","duration","originalID","originalPath","textarea","arrayTitle","showPositionTop","showPositionLeft","affixStatus","dialogReplaceTitle","alternateText","rightPopup","editAlignedIndex","methodList","defence","models","overTooltip","replace","remove","blank","gblur","mute","noise_white","modalityDisplay","video","audio","text","clear","dragDisplay","noise","gblurValue","gblurOptions","value","label","modifiedPlayer","modifiedWaveform","noiseObj","white","metro","office","park","diner","traffic","upload","dialogReplaceText","triangleTop","triangleLeft","tooltipTop","tooltipLeft","viewResults","methodData","modifiedTextList","conf","end","start","editAligned","form","name","defenceVideoUrl","regions","dataList","forEach","item","itemdata","attributes","data","note","loop","drag","resize","color","handleStyle","push","modifiedWaveformSwitch","addVideoModified","files","uploadMp4","file","fileList","status","is10M","size","raw","message","type","clearFiles","modifiedEvent","waveformCreate","load","on","dragBackgroundColor","length","nextButton","index","result","uploadFile","code","response","id","URL","createObjectURL","error","path","ASRResult","ASRClick","getVideoDuration","test","loading","service","lock","videoID","transcript","close","align","setTimeout","FormData","append","watchVideo","videoTime","hightLightInit","watchSwitch","highlightOver","modifiedVideoTimeEvent","that","count","timer","setInterval","currentTime","seekAndCenter","clearInterval","seekToTime","textitem","getCurrentTime","dragEnd","e","method","lastkey","element","document","elementFromPoint","clientX","clientY","$","parent","attr","Number","filter","dragOver","preventDefault","dataTransfer","dropEffect","modifiedWaveAudeo","videojs","onPlayerReady","player","getPlayer","dispose","flush","sliderInput","modifyCard","mouseDown","state","dialogConfirm","textOver","background","textBackground","offset","top","height","left","width","waveOver","waveBackground","target","getAttributeNode","rightClickItem","getElementById","offsetTop","offsetLeft","offsetWidth","generate","words","html","innerHTML","modalityModify","t","last","edit_aligned","window","addEventListener"],"sources":["/home/zhangbaozheng/emotional/Robust-MSA/vue3/src/views/VideoEditor.vue"],"sourcesContent":["<template>\n  <div class=\"appContainer\">\n    <div class=\"stepTop\">\n      <div class=\"arrayTitle\" :style=\"{ width: arrayTitle + 'px' }\">\n        Robust-MSA\n      </div>\n      <el-steps :active=\"activeStep\" class=\"elSteps\" simple>\n        <el-step\n          title=\"Upload Video\"\n          :icon=\"activeStep > 0 ? CircleCheckFilled : UploadFilled\"\n        />\n        <el-step\n          title=\"Revise Transcript\"\n          :icon=\"activeStep > 1 ? CircleCheckFilled : List\"\n        />\n        <el-step\n          title=\"Modify Video\"\n          :icon=\"activeStep > 2 ? CircleCheckFilled : EditPen\"\n        />\n        <el-step\n          title=\"Select Methods\"\n          :icon=\"activeStep > 3 ? CircleCheckFilled : Operation\"\n        />\n        <el-step\n          title=\"View Results\"\n          :icon=\"activeStep > 4 ? CircleCheckFilled : Histogram\"\n        />\n      </el-steps>\n    </div>\n    <div class=\"firstPageContainer\" v-if=\"activeStep === 0\">\n      <div class=\"tipNote\">\n        Note: Uploaded file should be no more than 10MB. Currently only support\n        English.\n      </div>\n      <el-upload\n        class=\"upload-demo\"\n        ref=\"upload\"\n        action=\"#\"\n        :auto-upload=\"false\"\n        :limit=\"1\"\n        drag\n        :on-change=\"uploadMp4\"\n        accept=\".MP4, .AVI, .MOV, .MKV, .3GP, .M4V, .FLV, .MPG, .mp4, .avi, .mov, .mkv, .3gp, .m4v, .flv, .mpg\"\n        :show-file-list=\"false\"\n      >\n        <div v-if=\"typeof currentFile == 'undefined' || currentFile == ''\">\n          <el-icon class=\"el-icon--upload\">\n            <upload-filled />\n          </el-icon>\n          <div class=\"el-upload__text\">\n            Drop file here or\n            <em>click to upload</em>\n          </div>\n        </div>\n        <div v-else class=\"successUpload\">\n          <el-icon class=\"el-icon--upload\">\n            <upload-filled />\n          </el-icon>\n          <div class=\"el-upload__text\">\n            Drop file here or\n            <em>click to upload</em>\n          </div>\n        </div>\n        <template #tip>\n          <div\n            class=\"el-upload__tip\"\n            v-if=\"!(typeof currentFile == 'undefined' || currentFile == '')\"\n          >\n            <el-icon>\n              <VideoCameraFilled />\n            </el-icon>\n            <span>Filename: {{ currentFile.name }}</span>\n          </div>\n        </template>\n      </el-upload>\n      <el-button\n        class=\"aligned elButton nextbutton\"\n        @click=\"nextButton(1)\"\n        size=\"small\"\n        type=\"primary\"\n        >Next</el-button\n      >\n    </div>\n    <div class=\"firstPageContainer\" v-if=\"activeStep === 1\">\n      <video id=\"my-player1\" class=\"video-js1\" controls data-setup=\"{}\">\n        <source :src=\"McurrentVideoUrl\" type=\"video/mp4\" />\n      </video>\n      <div class=\"transcriptCon\">\n        <div class=\"transcriptTip\">Transcript:</div>\n        <el-input\n          type=\"textarea\"\n          :rows=\"2\"\n          placeholder=\"Please enter\"\n          v-model=\"textarea\"\n        ></el-input>\n      </div>\n      <div>\n        <el-button\n          class=\"aligned elButton nextbutton\"\n          @click=\"nextButton(2)\"\n          size=\"small\"\n          type=\"primary\"\n          >Next</el-button\n        >\n      </div>\n    </div>\n    <div class=\"pageContainer\" v-else-if=\"activeStep === 2\">\n      <div class=\"modifiedCon\">\n        <div class=\"modifiedTopContainer\">\n          <div class=\"previewContainer\">\n            <div class=\"previewTop\">\n              <div class=\"topTip\">Preview</div>\n              <div class=\"topDescribe\">\n                Click \"generate\" button to preview changes.\n              </div>\n            </div>\n            <div id=\"modifiedContainer\">\n              <video\n                id=\"modified-my-player\"\n                class=\"video-js vjs-big-play-centered\"\n                controls\n              >\n                <source :src=\"McurrentVideoUrl\" type=\"video/mp4\" />\n              </video>\n            </div>\n          </div>\n          <div class=\"methodsContainer\">\n            <div class=\"methodsTop\">\n              <div class=\"topTip\">Modify Methods</div>\n              <div class=\"topDescribe\">\n                <span>Drag & drop</span> methods onto word to take effect\n              </div>\n            </div>\n            <el-card shadow=\"always\" class=\"methodContent\">\n              <div class=\"methodContainer\">\n                <div class=\"modalityMethod\">\n                  <span>Text Methods</span>\n                </div>\n                <div class=\"methodState\">\n                  <span\n                    draggable=\"true\"\n                    @dragend=\"dragEnd($event, 't', 'replace', 'off')\"\n                    >Replace</span\n                  >\n                </div>\n                <div class=\"methodState\">\n                  <span\n                    draggable=\"true\"\n                    @dragend=\"dragEnd($event, 't', 'remove', '')\"\n                    >Remove</span\n                  >\n                </div>\n              </div>\n            </el-card>\n            <div class=\"topDescribe\">\n              Fill in the form and click the Add button\n            </div>\n            <el-card shadow=\"always\" class=\"methodContent fromMethod\">\n              <div class=\"methodContainer\">\n                <div class=\"modalityMethod\">\n                  <span>Audio Methods</span>\n                </div>\n                <el-form :model=\"form\" label-width=\"100px\">\n                  <el-form-item label=\"Type\">\n                    <el-select\n                      v-model=\"form.type\"\n                      placeholder=\"please select your zone\"\n                    >\n                      <el-option label=\"volume\" value=\"volume\" />\n                      <el-option label=\"mute\" value=\"mute\" />\n                      <el-option label=\"coloran\" value=\"coloran\" />\n                      <el-option label=\"background\" value=\"background\" />\n                      <el-option label=\"sudden\" value=\"sudden\" />\n                      <el-option label=\"low pass\" value=\"lowpass\" />\n                      <el-option label=\"reverb\" value=\"reverb\" />\n                    </el-select>\n                  </el-form-item>\n                  <el-form-item label=\"Time mode\">\n                    <el-radio-group v-model=\"form.time_mode\">\n                      <el-radio label=\"exact\" />\n                      <el-radio label=\"percent\" />\n                    </el-radio-group>\n                  </el-form-item>\n                  <el-form-item label=\"Start time\">\n                    <el-input\n                      v-model=\"form.start\"\n                      placeholder=\"Please input\"\n                      type=\"text\"\n                    />\n                  </el-form-item>\n                  <el-form-item label=\"Time mode\">\n                    <el-radio-group v-model=\"form.time_mode\">\n                      <el-radio label=\"exact\" />\n                      <el-radio label=\"percent\" />\n                    </el-radio-group>\n                  </el-form-item>\n                </el-form>\n              </div>\n            </el-card>\n          </div>\n        </div>\n        <div class=\"modifiedWaveform\" v-if=\"modifiedWaveformSwitch\">\n          <div id=\"modifiedWaveTimeline\" ref=\"modifiedWaveTimeline\"></div>\n          <div\n            id=\"modifiedWaveform\"\n            ref=\"modifiedWaveform\"\n            @click=\"seekToTime(null)\"\n            @contextmenu.prevent=\"rightClickItem($event, 'wave')\"\n            @mouseover=\"\n              waveOver(\n                $event,\n                'rgba(255, 228, 196, 0.5)',\n                'rgba(255, 228, 196, 0.5)'\n              )\n            \"\n            @mouseout=\"waveOver($event, 'rgba(181, 198, 241, 0.2)', '#fff')\"\n          ></div>\n        </div>\n        <div class=\"textContent\">\n          <span\n            @mouseenter=\"\n              textOver(\n                $event,\n                index,\n                'rgba(255, 228, 196, 0.5)',\n                'rgba(255, 228, 196, 0.5)'\n              )\n            \"\n            @mouseleave=\"\n              textOver($event, index, 'rgba(181, 198, 241, 0.2)', '#fff')\n            \"\n            @contextmenu.prevent=\"rightClickItem($event, 'text')\"\n            @dragover=\"dragOver\"\n            @click=\"seekToTime(textitem.start)\"\n            v-for=\"(textitem, index) in modifiedTextList\"\n            :key=\"textitem\"\n            :id=\"index\"\n            >{{ textitem.text }}</span\n          >\n        </div>\n        <el-button\n          class=\"aligned elButton generate\"\n          @click=\"generate\"\n          type=\"danger\"\n          >Generate</el-button\n        >\n        <el-button\n          class=\"aligned elButton nextbutton\"\n          :type=\"McurrentVideoUrl == currentVideoUrl ? 'info' : 'primary'\"\n          @click=\"nextButton(3)\"\n          >Next</el-button\n        >\n      </div>\n    </div>\n    <div\n      class=\"pageContainer\"\n      style=\"position: relative\"\n      v-else-if=\"activeStep === 3\"\n    >\n      <select-method\n        class=\"selectMethod\"\n        @transmitMethods=\"methodList = $event\"\n      />\n      <el-button\n        class=\"aligned elButton nextbutton\"\n        style=\"margintop: 60px\"\n        @click=\"nextButton(4)\"\n        type=\"primary\"\n        >Next</el-button\n      >\n    </div>\n    <div class=\"pageContainer\" v-else-if=\"activeStep === 4\">\n      <view-result\n        :textList=\"modifiedTextList\"\n        :videoUrl=\"McurrentVideoUrl\"\n        :defenceVideoUrl=\"defenceVideoUrl\"\n        :originalVideoUrl=\"currentVideoUrl\"\n        :duration=\"duration\"\n        :editAligned=\"editAligned\"\n        :viewResults=\"viewResults\"\n        :methodData=\"methodData\"\n      />\n    </div>\n    <div\n      id=\"popup\"\n      :style=\"{\n        top: showPositionTop + 'px',\n        left: showPositionLeft + 'px',\n        position: 'absolute',\n      }\"\n      @mouseleave=\"\n        (modalityDisplay.audio = false),\n          (modalityDisplay.gblur = false),\n          (modalityDisplay.video = false),\n          (modalityDisplay.text = false)\n      \"\n    >\n      <div\n        v-show=\"rightPopup\"\n        :style=\"{ position: 'absolute' }\"\n        class=\"popupContainer\"\n      >\n        <div\n          class=\"modality\"\n          @mouseover=\"\n            (modalityDisplay.audio = false),\n              (modalityDisplay.gblur = false),\n              (modalityDisplay.video = true),\n              (modalityDisplay.text = false)\n          \"\n        >\n          <span>Video</span>\n          <el-icon>\n            <ArrowRight />\n          </el-icon>\n        </div>\n        <div\n          class=\"modality\"\n          @mouseover=\"\n            (modalityDisplay.audio = true),\n              (modalityDisplay.gblur = false),\n              (modalityDisplay.video = false),\n              (modalityDisplay.text = false)\n          \"\n        >\n          <span>Audio</span>\n          <el-icon>\n            <ArrowRight />\n          </el-icon>\n        </div>\n        <div\n          class=\"modality\"\n          @mouseover=\"\n            (modalityDisplay.audio = false),\n              (modalityDisplay.gblur = false),\n              (modalityDisplay.video = false),\n              (modalityDisplay.text = true)\n          \"\n        >\n          <span>Text</span>\n          <el-icon>\n            <ArrowRight />\n          </el-icon>\n        </div>\n        <div\n          class=\"modalityClose\"\n          v-show=\"modalityDisplay.clear\"\n          @click=\"modalityModify('clear', 'all')\"\n          @mouseover=\"\n            (modalityDisplay.audio = false),\n              (modalityDisplay.gblur = false),\n              (modalityDisplay.video = false),\n              (modalityDisplay.text = false)\n          \"\n        >\n          Clear\n        </div>\n      </div>\n      <div\n        v-show=\"\n          rightPopup &&\n          (modalityDisplay.video ||\n            modalityDisplay.audio ||\n            modalityDisplay.text)\n        \"\n        :style=\"{\n          top:\n            (modalityDisplay.audio ? 50 : 0) +\n            (modalityDisplay.video ? 10 : 0) +\n            (modalityDisplay.text ? 90 : 0) +\n            'px',\n          left: 140 + 'px',\n          position: 'relative',\n        }\"\n        class=\"popupContainer\"\n      >\n        <div v-show=\"modalityDisplay.video\">\n          <div\n            class=\"state\"\n            @mouseover=\"modalityDisplay.gblur = false\"\n            @click=\"modalityModify('blank', 'v')\"\n          >\n            <span>Blank</span>\n            <el-icon></el-icon>\n          </div>\n          <div class=\"state\" @mouseover=\"modalityDisplay.gblur = true\">\n            <span>Gblur</span>\n            <el-icon>\n              <ArrowRight />\n            </el-icon>\n          </div>\n        </div>\n        <div v-show=\"modalityDisplay.audio\">\n          <div class=\"state\" @click=\"modalityModify('mute', 'a')\">\n            <span>Mute</span>\n            <el-icon></el-icon>\n          </div>\n          <!-- <div class=\"state\" @click=\"modalityModify('noise-white','a')\">Noise-white</div> -->\n        </div>\n        <div v-show=\"modalityDisplay.text\">\n          <div class=\"state\" @click=\"modalityModify('replace', 't')\">\n            <span>Replace</span>\n            <el-icon></el-icon>\n          </div>\n          <div class=\"state\" @click=\"modalityModify('remove', 't')\">\n            <span>Remove</span>\n            <el-icon></el-icon>\n          </div>\n        </div>\n      </div>\n      <div\n        v-show=\"rightPopup && modalityDisplay.gblur\"\n        :style=\"{ top: -30 + 'px', left: 280 + 'px', position: 'relative' }\"\n        class=\"popupContainer\"\n      >\n        <div>\n          <div class=\"state\" @click=\"modalityModify('gblur', 'v', 'low')\">\n            <span style=\"display: block; width: 70px\">Low</span>\n            <el-icon></el-icon>\n          </div>\n          <div class=\"state\" @click=\"modalityModify('gblur', 'v', 'medium')\">\n            <span style=\"display: block; width: 70px\">Medium</span>\n            <el-icon></el-icon>\n          </div>\n          <div class=\"state\" @click=\"modalityModify('gblur', 'v', 'high')\">\n            <span style=\"display: block; width: 70px\">High</span>\n            <el-icon></el-icon>\n          </div>\n        </div>\n      </div>\n    </div>\n    <el-dialog v-model=\"dialogReplaceText\" title=\"Text replacement\" width=\"30%\">\n      <div class=\"dialogReplaceTextContainer\">\n        <div class=\"dialogReplaceItem\">\n          <div class=\"dialogReplaceTitle\">Word:</div>\n          <el-input readonly v-model=\"dialogReplaceTitle\" />\n        </div>\n        <div class=\"dialogReplaceItem\">\n          <div class=\"dialogReplaceTitle\">Alternate:</div>\n          <el-input v-model=\"alternateText\" placeholder=\"Please input\" />\n        </div>\n      </div>\n      <template #footer>\n        <span class=\"dialog-footer\">\n          <el-button type=\"primary\" @click=\"dialogConfirm\">Confirm</el-button>\n        </span>\n      </template>\n    </el-dialog>\n    <div\n      class=\"ztooltip\"\n      v-if=\"\n        overTooltip.replace ||\n        overTooltip.remove ||\n        overTooltip.blank ||\n        overTooltip.gblur ||\n        overTooltip.mute ||\n        overTooltip.noise_white\n      \"\n      :style=\"{\n        top: tooltipTop + 'px',\n        left: tooltipLeft + 'px',\n      }\"\n    >\n      <span v-if=\"overTooltip.replace\">Text: Replace</span>\n      <span v-if=\"overTooltip.remove\">Text: Remove</span>\n      <span v-if=\"overTooltip.blank\">Video: Blank</span>\n      <span v-if=\"overTooltip.gblur\">Video: Gblur</span>\n      <span v-if=\"overTooltip.mute\">Audio: Mute</span>\n      <span v-if=\"overTooltip.noise_white\">Audio: Noise-white</span>\n    </div>\n    <div\n      class=\"triangle\"\n      v-if=\"\n        overTooltip.replace ||\n        overTooltip.remove ||\n        overTooltip.blank ||\n        overTooltip.gblur ||\n        overTooltip.mute ||\n        overTooltip.noise_white\n      \"\n      :style=\"{\n        top: triangleTop + 'px',\n        left: triangleLeft + 'px',\n      }\"\n    ></div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, watchEffect, computed, onMounted } from \"vue\";\nimport {\n  EditPen,\n  List,\n  UploadFilled,\n  Operation,\n  Histogram,\n  CircleCheckFilled,\n  Flag,\n} from \"@element-plus/icons-vue\";\nimport SelectMethod from \"@/components/SelectMethod.vue\";\nimport ViewResult from \"@/components/ViewResult.vue\";\nimport { uploadVideo, uploadTranscript } from \"@/api/upload\";\nimport OperationMethod from \"@/utils/operation.js\";\nimport { callASR } from \"@/api/detection\";\nimport { videoEditAligned, getFileFromUrl } from \"@/api/modify\";\nimport { ElLoading, ElMessage } from \"element-plus\";\nimport { runMSAAligned } from \"@/api/detection\";\nconst currentFile = ref(\"\");\nconst McurrentFile = ref(\"\");\nconst currentVideoUrl = ref(\"\");\nconst McurrentVideoUrl = ref(\"\");\nconst activeStep = ref(2);\nconst modifiedVideoTime = ref(0);\nconst modifiedWavesurfer = ref(null);\nconst duration = ref(0);\nconst originalID = ref(\"\");\nconst originalPath = ref(\"\");\nconst textarea = ref(\"\");\nconst arrayTitle = ref(\"\");\nconst showPositionTop = ref(0);\nconst showPositionLeft = ref(0);\nconst affixStatus = ref(true);\nconst dialogReplaceTitle = ref(\"\");\nconst alternateText = ref(\"\");\nconst rightPopup = ref(false);\nconst editAlignedIndex = ref(-1);\nconst methodList = ref({\n  defence: [],\n  models: [\"MMIN\", \"TFR_Net\", \"T2FN\", \"TPFN\"],\n});\nconst overTooltip = ref({\n  replace: false,\n  remove: false,\n  blank: false,\n  gblur: false,\n  mute: false,\n  noise_white: false,\n});\nconst modalityDisplay = ref({\n  video: false,\n  audio: false,\n  text: false,\n  gblur: false,\n  clear: false,\n});\nconst dragDisplay = ref({\n  video: true,\n  audio: true,\n  text: true,\n  noise: true,\n});\nconst gblurValue = ref(\"low\");\nconst gblurOptions = ref([\n  {\n    value: \"low\",\n    label: \"Low\",\n  },\n  {\n    value: \"medium\",\n    label: \"Medium\",\n  },\n  {\n    value: \"high\",\n    label: \"High\",\n  },\n]);\nconst modifiedPlayer = ref(null);\nconst modifiedWaveform = ref(null);\nconst noiseObj = ref({\n  white: 0,\n  metro: 0,\n  office: 0,\n  park: 0,\n  diner: 0,\n  traffic: 0,\n});\nconst upload = ref(\"\");\nconst dialogReplaceText = ref(false);\nconst triangleTop = ref(0);\nconst triangleLeft = ref(0);\nconst tooltipTop = ref(0);\nconst tooltipLeft = ref(0);\nconst viewResults = ref(null);\nconst methodData = ref(null);\nconst modifiedTextList = ref([\n  {\n    conf: 0.9924983864489116,\n    end: 0.25155598958333336,\n    start: 0.05031119791666667,\n    text: \"now\",\n  },\n  {\n    conf: 0.7846563020477458,\n    end: 0.4729252604166667,\n    start: 0.25155598958333336,\n    text: \"the\",\n  },\n  {\n    conf: 0.6531528330428251,\n    end: 0.8351658854166667,\n    start: 0.4729252604166667,\n    text: \"title\",\n  },\n  {\n    conf: 0.47641091293124294,\n    end: 1.0766596354166666,\n    start: 0.8351658854166667,\n    text: \"of\",\n  },\n  {\n    conf: 0.24061251992673066,\n    end: 1.1974065104166667,\n    start: 1.0766596354166666,\n    text: \"the\",\n  },\n  {\n    conf: 0.5447095983243366,\n    end: 1.4590247395833333,\n    start: 1.1974065104166667,\n    text: \"movie\",\n  },\n  {\n    conf: 0.6084983060602999,\n    end: 1.8212653645833332,\n    start: 1.4590247395833333,\n    text: \"baseke\",\n  },\n  {\n    conf: 0.6754744243939316,\n    end: 2.0426346354166665,\n    start: 1.8212653645833332,\n    text: \"sets\",\n  },\n  {\n    conf: 0.47667267739500935,\n    end: 2.14325703125,\n    start: 2.0426346354166665,\n    text: \"it\",\n  },\n  {\n    conf: 0.6783241011170195,\n    end: 2.3646263020833334,\n    start: 2.14325703125,\n    text: \"all\",\n  },\n]);\nconst editAligned = ref([]);\nconst form = ref({\n  name: \"\",\n});\nconst defenceVideoUrl = ref(\"\");\nconst regions = computed(() => {\n  let dataList = [];\n  modifiedTextList.value.forEach((item) => {\n    let itemdata = {\n      start: 0,\n      end: 0,\n      attributes: {\n        label: \"\",\n      },\n      data: {\n        note: \"\",\n      },\n      loop: false,\n      drag: false,\n      resize: false,\n      color: \"rgba(181, 198, 241, 0.2)\",\n      handleStyle: false,\n    };\n    itemdata.start = item.start;\n    itemdata.end = item.end;\n    dataList.push(itemdata);\n  });\n  return dataList;\n});\nconst modifiedWaveformSwitch = ref(true);\nconst addVideoModified = (files) => {\n  McurrentFile.value = files;\n};\nconst uploadMp4 = async (file, fileList) => {\n  if (file.status === \"ready\") {\n    const is10M = file.size / 1024 / 1024 < 10;\n    if (is10M) {\n      currentFile.value = file.raw;\n    } else {\n      ElMessage({\n        message: \"Uploaded file should be no more than 10MB.\",\n        type: \"warning\",\n      });\n    }\n    upload.value.clearFiles();\n  }\n};\nconst modifiedEvent = () => {\n  modifiedWavesurfer.value = OperationMethod.waveformCreate(\n    modifiedWaveform.value,\n    regions.value\n  );\n  modifiedWavesurfer.value.load(McurrentVideoUrl.value);\n  modifiedWavesurfer.value.on(\"ready\", () => {\n    OperationMethod.dragBackgroundColor(\n      editAligned.value,\n      modifiedTextList.value.length\n    );\n  });\n};\n\nconst nextButton = async (index) => {\n  if (index == 1) {\n    if (typeof currentFile.value == \"undefined\" || currentFile.value == \"\") {\n      ElMessage({\n        message: \"Please select a file.\",\n        type: \"warning\",\n      });\n      return;\n    }\n    let result = await uploadFile(currentFile.value);\n    if (result.code === 200) {\n      // McurrentVideoUrl.value = `${window.static_url}/${result.id}/raw_video.mp4`;\n      try {\n        var response = await getFileFromUrl(\n          `${result.id}/raw_video.mp4`,\n          \"raw_video.mp4\"\n        );\n        // this.McurrentVideoUrl = `${window.static_url}/${result.id}/raw_video.mp4`\n        McurrentVideoUrl.value = URL.createObjectURL(response);\n      } catch (error) {\n        return;\n      }\n      originalID.value = result.id;\n      originalPath.value = result.path;\n      let ASRResult = await ASRClick(result.id);\n      if (ASRResult.code != 200) {\n        return;\n      }\n      try {\n        var response = await getFileFromUrl(\n          `${result.id}/raw_video.mp4`,\n          \"raw_video.mp4\"\n        );\n      } catch (error) {\n        return;\n      }\n      duration.value =\n        (await OperationMethod.getVideoDuration(response)) / 1000000;\n      addVideoModified([response]);\n    } else {\n      return;\n    }\n    // addVideoModified([currentFile.value]);\n    // duration.value = 12.3;\n  } else if (index == 2) {\n    if (textarea.value) {\n      if (/\\d/.test(textarea.value)) {\n        ElMessage({\n          message: \"Please substitute numbers with text\",\n          type: \"warning\",\n        });\n        return;\n      }\n      const loading = ElLoading.service({\n        lock: true,\n        text: \"Aligning video with transcript...\",\n      });\n      try {\n        var result = await uploadTranscript({\n          videoID: originalID.value,\n          transcript: textarea.value,\n        });\n        loading.close();\n      } catch (error) {\n        loading.close();\n        return;\n      }\n      modifiedTextList.value = result.data.align;\n      currentVideoUrl.value = McurrentVideoUrl.value;\n    }\n    setTimeout(() => {\n      modifiedEvent();\n    }, 5);\n  } else if (index == 3) {\n    if (McurrentVideoUrl.value === currentVideoUrl.value) {\n      ElMessage({\n        message: \"After modifying the video, please click generate.\",\n        type: \"warning\",\n      });\n      return;\n    }\n  } else if (index == 4) {\n    if (methodList.value.models.length == 0) {\n      ElMessage({\n        message: \"Please select at least one msa model.\",\n        type: \"warning\",\n      });\n      return;\n    } else {\n      methodData.value = methodList.value;\n      methodData.value[\"videoID\"] = originalID.value;\n      const loading = ElLoading.service({\n        lock: true,\n        text: \"Processing, please wait...\",\n      });\n      try {\n        let result = await runMSAAligned(methodData.value);\n        defenceVideoUrl.value = await getFileFromUrl(\n          `${originalID.value}/defended_video.mp4`,\n          \"defended_video.mp4\"\n        );\n        defenceVideoUrl.value = URL.createObjectURL(defenceVideoUrl.value);\n        viewResults.value = result.data;\n        loading.close();\n      } catch (error) {\n        loading.close();\n        return;\n      }\n    }\n  }\n  activeStep.value++;\n};\n\nconst uploadFile = async (file) => {\n  const loading = ElLoading.service({\n    lock: true,\n    text: \"Video uploading, please wait...\",\n  });\n  let data = new FormData();\n  data.append(\"video\", file);\n  try {\n    var result = await uploadVideo(data);\n  } catch (error) {\n    return { code: 400 };\n  } finally {\n    loading.close();\n  }\n  return result.data;\n};\n\nconst ASRClick = async (originalID) => {\n  const loading = ElLoading.service({\n    lock: true,\n    text: \"Speech Recognition in progress...\",\n  });\n  try {\n    const ASRResult = await callASR({ videoID: originalID });\n    textarea.value = ASRResult.data.result;\n  } catch (error) {\n    return { code: 400 };\n  } finally {\n    loading.close();\n  }\n  return { code: 200 };\n};\nconst watchVideo = (videoTime) => {\n  if (\n    videoTime > modifiedTextList.value[modifiedTextList.value.length - 1].end\n  ) {\n    OperationMethod.hightLightInit();\n    return OperationMethod.dragBackgroundColor(\n      editAligned.value,\n      modifiedTextList.value.length\n    );\n  }\n  let watchSwitch = true;\n  for (let index = 0; index < modifiedTextList.value.length; index++) {\n    if (\n      modifiedTextList.value[index].start < videoTime &&\n      videoTime <= modifiedTextList.value[index].end\n    ) {\n      OperationMethod.highlightOver(\n        index - 1,\n        \"rgba(181, 198, 241, 0.2)\",\n        \"#fff\"\n      );\n      OperationMethod.highlightOver(\n        index,\n        \"rgba(255, 228, 196, 0.5)\",\n        \"rgba(255, 228, 196, 0.5)\"\n      );\n      OperationMethod.dragBackgroundColor(\n        editAligned.value,\n        modifiedTextList.value.length\n      );\n      watchSwitch = false;\n      break;\n    }\n  }\n  if (watchSwitch) {\n    OperationMethod.hightLightInit();\n    OperationMethod.dragBackgroundColor(\n      editAligned.value,\n      modifiedTextList.value.length\n    );\n  }\n};\nconst modifiedVideoTimeEvent = (that) => {\n  let count = 10;\n  let timer = setInterval(() => {\n    modifiedVideoTime.value = that.currentTime();\n    modifiedWavesurfer.value.seekAndCenter(\n      modifiedVideoTime.value / duration.value > 1\n        ? 1\n        : modifiedVideoTime.value / duration.value\n    );\n    watchVideo(modifiedVideoTime.value);\n    count == 0 ? clearInterval(timer) : count--;\n  }, 25);\n};\nconst seekToTime = (textitem) => {\n  if (textitem == null) {\n    setTimeout(() => {\n      modifiedPlayer.value.currentTime(\n        modifiedWavesurfer.value.getCurrentTime() + 0.000001\n      );\n    }, 5);\n  } else {\n    modifiedPlayer.value.currentTime(textitem + 0.000001);\n  }\n};\nconst dragEnd = (e, type, method, lastkey) => {\n  var element = document.elementFromPoint(e.clientX, e.clientY);\n  if ($(element).parent().attr(\"class\") == \"textContent\") {\n    editAlignedIndex.value = Number($(element).attr(\"id\"));\n    editAligned.value = editAligned.value.filter((item) => {\n      return !(\n        item[0] == editAlignedIndex.value &&\n        item[1] == type &&\n        item[2] == method\n      );\n    });\n    let item = [editAlignedIndex.value, type, method, lastkey];\n    if (method == \"replace\") {\n      dialogReplaceText.value = true;\n      dialogReplaceTitle.value =\n        modifiedTextList.value[editAlignedIndex.value].text;\n      return;\n    }\n    editAligned.value.push(item);\n    OperationMethod.dragBackgroundColor(\n      editAligned.value,\n      modifiedTextList.value.length\n    );\n  }\n};\nconst dragOver = (e) => {\n  e.preventDefault();\n  e.dataTransfer.dropEffect = \"move\";\n};\nconst modifiedWaveAudeo = () => {\n  modifiedPlayer.value = videojs(\n    \"modified-my-player\",\n    {},\n    function onPlayerReady() {\n      this.on(\"play\", function (e) {\n        modifiedVideoTimeEvent(this);\n      });\n      this.on(\"timeupdate\", function (e) {\n        modifiedVideoTimeEvent(this);\n      });\n      this.on(\"seeked\", function () {\n        OperationMethod.hightLightInit();\n      });\n    }\n  );\n};\nwatchEffect(\n  () => {\n    if (activeStep.value == 2) {\n      let player = videojs.getPlayer(\"modified-my-player\");\n      if (player) {\n        player.dispose();\n      }\n      modifiedWaveAudeo();\n    }\n  },\n  {\n    flush: \"post\",\n  }\n);\nconst sliderInput = (e) => {\n  editAligned.value = OperationMethod.modifyCard(\n    editAligned.value,\n    noiseObj.value,\n    modifiedTextList.value.length\n  );\n};\nwatchEffect(() => {\n  OperationMethod.dragBackgroundColor(\n    editAligned.value,\n    modifiedTextList.value.length\n  );\n});\n\nconst mouseDown = (e) => {\n  var state = true;\n  try {\n    e.path.forEach((item) => {\n      if ($(item).attr(\"id\") == \"popup\") {\n        state = false;\n      }\n    });\n  } catch (error) {\n    return;\n  }\n\n  if (state && modifiedTextList.value.length) {\n    rightPopup.value = false;\n    OperationMethod.hightLightInit();\n    OperationMethod.dragBackgroundColor(\n      editAligned.value,\n      modifiedTextList.value.length\n    );\n  }\n};\nconst dialogConfirm = () => {\n  dialogReplaceText.value = false;\n  rightPopup.value = false;\n  let item = [editAlignedIndex.value, \"t\", \"replace\", alternateText.value];\n  editAligned.value.push(item);\n  OperationMethod.dragBackgroundColor(\n    editAligned.value,\n    modifiedTextList.value.length\n  );\n};\nconst textOver = async (e, index, background, textBackground) => {\n  if (!rightPopup.value) {\n    await OperationMethod.highlightOver(index, background, textBackground);\n  }\n  OperationMethod.dragBackgroundColor(\n    editAligned.value,\n    modifiedTextList.value.length\n  );\n  overTooltip.value = {\n    replace: false,\n    remove: false,\n    blank: false,\n    gblur: false,\n    mute: false,\n    noise_white: false,\n  };\n  if (textBackground != \"#fff\") {\n    editAligned.value.forEach((item) => {\n      if (item[0] == index) {\n        overTooltip.value[\n          item[2] == \"noise-white\" ? \"noise_white\" : item[2]\n        ] = true;\n      }\n    });\n    triangleTop.value = $(`#${index}`).offset().top + $(`#${index}`).height();\n    tooltipTop.value = triangleTop.value + 8;\n\n    triangleLeft.value =\n      $(`#${index}`).offset().left +\n      $(`#${index}`).width() / 2 -\n      5 -\n      $(`.appContainer`).offset().left;\n    tooltipLeft.value = triangleLeft.value - 40;\n    setTimeout(() => {\n      tooltipLeft.value = triangleLeft.value - $(`.ztooltip`).width() / 2 + 2;\n    }, 1);\n  }\n};\nconst waveOver = async (e, waveBackground, textBackground) => {\n  if (\n    e.target.getAttributeNode(\"class\") &&\n    e.target.getAttributeNode(\"class\").value === \"wavesurfer-region\" &&\n    !rightPopup.value\n  ) {\n    let index = $(`#modifiedWaveform > wave > region.wavesurfer-region`).index(\n      e.target\n    );\n    await OperationMethod.highlightOver(index, waveBackground, textBackground);\n  }\n  OperationMethod.dragBackgroundColor(\n    editAligned.value,\n    modifiedTextList.value.length\n  );\n};\n\nconst rightClickItem = async (e, type) => {\n  const element = document.getElementById(`${e.target.id}`);\n  showPositionTop.value = element.offsetTop + 80 || 0;\n  showPositionLeft.value = element.offsetLeft + element.offsetWidth + 25 || 0;\n  rightPopup.value = true;\n  await OperationMethod.hightLightInit();\n  let index = $(\n    type == \"wave\"\n      ? \"#modifiedWaveform > wave > region.wavesurfer-region\"\n      : \".pageContainer .modifiedCon .textContent span\"\n  ).index(e.target);\n  editAligned.value.index = index;\n  await OperationMethod.highlightOver(\n    index,\n    \"rgba(255, 228, 196, 0.5)\",\n    \"rgba(255, 228, 196, 0.5)\"\n  );\n  modalityDisplay.value.clear = false;\n  editAligned.value.forEach((item) => {\n    if (item[0] == index) {\n      modalityDisplay.value.clear = true;\n    }\n  });\n  modalityDisplay.value.clear =\n    noiseObj.value.white ||\n    noiseObj.value.metro ||\n    noiseObj.value.office ||\n    noiseObj.value.park ||\n    noiseObj.value.diner ||\n    noiseObj.value.traffic ||\n    modalityDisplay.value.clear\n      ? true\n      : false;\n};\nconst generate = async () => {\n  if (editAligned.value.length == 0) {\n    ElMessage({\n      message: \"Please modify the video first.\",\n      type: \"warning\",\n    });\n    return;\n  }\n  let data = {\n    videoID: originalID.value,\n    words: editAligned.value,\n  };\n  const loading = ElLoading.service({\n    lock: true,\n    text: \"Generating modified video...\",\n  });\n  try {\n    var result = await videoEditAligned(data);\n  } catch (error) {\n    loading.close();\n    return;\n  }\n  if (result.data.code == 200) {\n    McurrentFile.value = \"\";\n    try {\n      var response = await getFileFromUrl(\n        `${originalID.value}/modified_video.mp4`,\n        \"modified_video.mp4\"\n      );\n      McurrentVideoUrl.value = URL.createObjectURL(response);\n    } catch (error) {\n      loading.close();\n      return;\n    }\n    addVideoModified([response]);\n    modifiedPlayer.value.dispose();\n    let html =\n      '<video id=\"modified-my-player\" class=\"video-js vjs-big-play-centered\" controls=\"true\"><source src=\"' +\n      McurrentVideoUrl.value +\n      '\" type=\"video/mp4\" /></video>';\n    document.getElementById(\"modifiedContainer\").innerHTML = html;\n    modifiedWaveAudeo();\n    modifiedWaveformSwitch.value = false;\n    setTimeout(() => {\n      modifiedWaveformSwitch.value = true;\n      setTimeout(() => {\n        modifiedEvent();\n      }, 2);\n    }, 2);\n    editAligned.value.forEach((item) => {\n      if (item[1] == \"t\") {\n        if (item[2] == \"replace\") {\n          modifiedTextList.value[item[0]].text = item[3];\n        } else {\n          modifiedTextList.value[item[0]].text = \"[REMOVED]\";\n        }\n      }\n    });\n    loading.close();\n  }\n};\nconst modalityModify = (e, t, last = \"\") => {\n  OperationMethod.hightLightInit();\n  let edit_aligned = editAligned.value.filter((item) => {\n    return item[0] == editAligned.value.index && (item[1] == t || \"all\" == t)\n      ? false\n      : true;\n  });\n  if (e != \"clear\") {\n    let lastkey = \"\";\n    if (t == \"v\") {\n      lastkey = e == \"gblur\" ? last : \"\";\n    } else if (t == \"a\") {\n      lastkey = e == \"noise-white\" ? \"low\" : \"\";\n    } else if (e == \"replace\") {\n      dialogReplaceText.value = true;\n      dialogReplaceTitle.value =\n        modifiedTextList.value[editAligned.value.index].text;\n      return;\n    }\n    let item = [editAligned.value.index, t, e, lastkey];\n    edit_aligned.push(item);\n  } else {\n    edit_aligned = [];\n    noiseObj.value = {\n      white: 0,\n      metro: 0,\n      office: 0,\n      park: 0,\n      diner: 0,\n      traffic: 0,\n    };\n    OperationMethod.dragBackgroundColor(\n      edit_aligned,\n      modifiedTextList.value.length\n    );\n  }\n  editAligned.value = edit_aligned;\n  rightPopup.value = false;\n};\nonMounted(() => {\n  window.addEventListener(\"mousedown\", mouseDown);\n  arrayTitle.value = $(\".elSteps\").width() + 5;\n});\n</script>\n\n<style scoped lang=\"scss\">\n.drag_box {\n  position: absolute;\n  font-size: 14px;\n  line-height: 25px;\n  z-index: 100;\n  color: #616161;\n  user-select: none;\n}\n.appContainer {\n  margin: 0 auto;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  position: relative;\n  width: 850px;\n  overflow: hidden;\n}\n.stepTop {\n  position: absolute;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  top: 0;\n  left: 0;\n  width: 100%;\n  background-color: #fff !important;\n  z-index: 99;\n}\n.elSteps {\n  background-color: #fff;\n}\n.firstPageContainer {\n  position: relative;\n}\n.firstPageContainer,\n.pageContainer {\n  padding-top: 80px;\n  width: 800px;\n  padding-bottom: 150px;\n}\n.modifiedCon {\n  position: relative;\n}\n.tipNote {\n  font-size: 14px;\n  color: #5f5f5f;\n  margin-top: 50px;\n}\n.upload-demo {\n  margin-top: 15px;\n  height: 260px;\n}\n.arrayTitle {\n  position: relative;\n  padding-top: 10px;\n  font-size: 21px;\n  color: #464646;\n}\n.firstPageContainer .elButton {\n  width: 100px;\n  height: 30px;\n}\n.firstPageContainer .aligned {\n  margin-left: 150px;\n}\n.modifiedTopContainer {\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n}\n.topTip {\n  font-size: 18px;\n  color: #353535;\n}\n.topDescribe {\n  font-size: 14px;\n  color: #727272;\n  margin-top: 5px;\n}\n.topDescribe span {\n  font-weight: bold;\n}\n.methodContent {\n  width: 320px;\n  height: 93px;\n  overflow: hidden;\n  margin-top: 10px;\n}\n\n.fromMethod {\n  height: 500px;\n}\n\n.methodContent::-webkit-scrollbar {\n  width: 10px;\n}\n\n.methodContent::-webkit-scrollbar-track {\n  background-color: rgb(255, 255, 255);\n  box-shadow: inset 0 0 2px rgba(0, 0, 0, 0.2);\n}\n\n.methodContent::-webkit-scrollbar-thumb {\n  background-color: rgb(207, 207, 207);\n  border-radius: 10px;\n}\n.fixedIcon {\n  position: absolute;\n  right: 20px;\n  height: 20px;\n  width: 20px;\n}\n.video-js1 {\n  margin-top: 15px;\n  width: 800px;\n  height: 500px;\n}\n.video-js {\n  margin-top: 15px;\n}\n#app\n  .firstPageContainer\n  button.el-button.elButton.el-button--default.el-button--small {\n  margin-left: 0;\n}\n.firstPageContainer .transcriptCon {\n  width: 800px;\n  display: flex;\n  margin-top: 15px;\n}\n.firstPageContainer .transcriptTip {\n  width: 100px;\n}\n.nextbutton {\n  margin-top: 20px;\n  position: absolute;\n  width: 95px;\n  right: 0;\n}\n.pageContainer .videoframe {\n  overflow-x: scroll;\n  margin-top: 20px;\n  width: 800px;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  overflow-y: hidden;\n  box-shadow: 0 0 1px 1px rgb(211, 211, 211);\n  border-radius: 5px;\n  height: 120px;\n}\n.modifiedWaveform {\n  width: 470px;\n  position: relative;\n  margin-top: 20px;\n  box-shadow: 0 0 1px 1px rgb(211, 211, 211);\n  border-radius: 5px;\n  overflow-y: hidden;\n}\n#waveform > wave::-webkit-scrollbar {\n  height: 10px;\n}\n#waveform > wave::-webkit-scrollbar-track {\n  background-color: rgb(255, 255, 255);\n  box-shadow: inset 0 0 2px rgba(0, 0, 0, 0.2);\n}\n#waveform > wave::-webkit-scrollbar-thumb {\n  background-color: rgb(207, 207, 207);\n  border-radius: 10px;\n}\n.textContent {\n  margin-top: 10px;\n  padding-bottom: 20px;\n  width: 800px;\n  font-size: 18px;\n  line-height: 25px;\n}\n.textContent span {\n  display: inline-block;\n  margin-top: 5px;\n  margin-right: 10px;\n  user-select: none;\n}\n.textContent span:hover {\n  background-color: rgba(255, 228, 196, 0.5);\n  cursor: pointer;\n}\n.popupContainer {\n  box-shadow: 1px 1px 1px 1px rgb(189, 189, 189);\n  width: 130px;\n  background: #fff;\n  padding: 10px;\n  line-height: 30px;\n  color: rgb(77, 77, 77);\n  font-size: 16px;\n  z-index: 99;\n}\n.popupContainer .modality {\n  width: 100%;\n  display: flex;\n  flex-direction: row;\n  justify-content: space-around;\n  line-height: 40px;\n  align-items: center;\n  font-size: 15px;\n}\n.popupContainer .modality span {\n  display: inline-block;\n  width: 70px;\n  color: rgb(73, 73, 73);\n}\n.popupContainer .state {\n  display: flex;\n  flex-direction: row;\n  justify-content: space-around;\n  align-items: center;\n  width: 100%;\n  font-size: 14px;\n  color: rgb(105, 105, 105);\n}\n.popupContainer .modalityClose {\n  padding-left: 10px;\n  font-size: 14px;\n}\n.popupContainer .modality:hover,\n.popupContainer .modalityClose:hover,\n.popupContainer .state:hover {\n  cursor: pointer;\n  background-color: rgb(236, 236, 236);\n}\n.generate {\n  margin-left: 580px;\n  margin-top: 20px;\n  width: 95px;\n}\n.dialogReplaceTextContainer {\n  display: flex;\n  flex-direction: column;\n  margin-top: -30px;\n}\n.dialogReplaceTitle {\n  width: 100px;\n}\n.dialogReplaceItem {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  margin-top: 10px;\n}\n.modalityMethod {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  line-height: 25px;\n  user-select: none;\n}\n.modalityMethod span {\n  margin-top: -1.5px;\n  margin-left: 10px;\n  font-size: 15px;\n}\n.methodState {\n  margin-left: 26px;\n  font-size: 14px;\n  position: relative;\n  color: #616161;\n  line-height: 25px;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  user-select: none;\n}\n.methodStateNoise {\n  margin-left: 26px;\n  font-size: 14px;\n  position: relative;\n  color: #616161;\n  line-height: 24px;\n  display: flex;\n  flex-direction: column;\n  margin-top: 0.5px;\n  user-select: none;\n}\n.noiseTitle {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n}\n.noiseTitle span {\n  margin-left: 5px;\n  margin-top: -0.5px;\n}\n.noiseContainer {\n  display: flex;\n  flex-direction: column;\n  line-height: 23px;\n  margin-left: 20px;\n  font-size: 13px;\n  width: 235px;\n}\n.noiseItem {\n  display: flex;\n  flex-direction: row;\n}\n.noiseItem span {\n  width: 100px;\n  display: inline-block;\n}\n.methodStateNoise span:hover,\n.modalityMethod span:hover,\n.methodState:hover,\n.dragDiv:hover {\n  cursor: pointer;\n}\n.methodState span:hover {\n  background-color: rgb(230, 230, 230);\n}\n.dragDiv {\n  position: absolute;\n  top: 200px;\n  left: 100px;\n  border: 1px solid black;\n  user-select: none;\n}\n.ztooltip {\n  position: absolute;\n  padding: 10px;\n  border-radius: 5px;\n  background-color: rgb(29, 29, 29);\n  color: aliceblue;\n  display: flex;\n  flex-direction: column;\n  font-size: 14px;\n  line-height: 22px;\n}\n.triangle {\n  position: absolute;\n  width: 0;\n  height: 0;\n  border-left: 5px solid transparent;\n  border-right: 7px solid transparent;\n  border-bottom: 10px solid rgb(29, 29, 29);\n}\n.selectMethod {\n  position: relative;\n  top: 10px;\n}\n.gblurSelect {\n  margin-left: 20px;\n  width: 90px;\n}\n.elSlider {\n  width: 100px;\n}\n</style>\n\n<style lang=\"scss\">\n.el-step.is-simple .el-step__arrow {\n  flex-grow: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 50px !important;\n  transform: scale(0.5);\n}\n.el-step.is-simple {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  flex-basis: 0 !important;\n}\n.el-step.is-simple .el-step__icon {\n  width: 16px;\n  height: 20px;\n  line-height: 20px;\n}\n.el-step.is-simple .el-step__main {\n  position: relative;\n  display: flex;\n  align-items: stretch;\n  flex-grow: 0;\n  width: max-content;\n}\n.el-step.is-simple .el-step__title {\n  font-size: 14px;\n}\n#app .stepTop .el-step__main .el-step__title {\n  max-width: 100%;\n}\n.el-step:last-of-type.is-flex {\n  width: 121px;\n}\n#modified-my-player {\n  margin-top: 15px;\n  width: 470px;\n  height: 340px;\n}\n.stepTop .el-step__main .is-finish,\n.stepTop .is-finish {\n  color: #67c23a;\n}\ndiv.stepTop .is-process > div,\n#app .stepTop .el-step__main .is-process {\n  color: #409eff;\n}\n.el-upload-dragger .successUpload .el-icon--upload {\n  color: #409eff;\n}\n.el-upload__tip {\n  font-size: 13px;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n}\n.el-upload__tip span {\n  margin-left: 5px;\n}\n.el-card__body {\n  padding: 10px;\n}\n.tooltip-base-box .box-item {\n  width: 110px;\n}\n.el-dialog__body {\n  height: 40px;\n}\n.el-dialog__footer {\n  padding-top: 0;\n}\n#modifiedWaveform {\n  height: 90px !important;\n}\n#modifiedWaveform > wave {\n  height: 90px !important;\n  &::-webkit-scrollbar {\n    height: 10px;\n  }\n  &::-webkit-scrollbar-track {\n    background-color: rgb(255, 255, 255);\n    box-shadow: inset 0 0 2px rgba(0, 0, 0, 0.2);\n  }\n  &::-webkit-scrollbar-thumb {\n    background-color: rgb(207, 207, 207);\n    border-radius: 10px;\n  }\n}\n.methodContent .el-slider__runway.show-input {\n  margin-right: 10px;\n}\n.methodContent .el-slider__button {\n  height: 14px;\n  width: 14px;\n}\n.methodContent .el-slider__input {\n  width: 60px;\n}\n.methodContent .el-input-number__decrease,\n.methodContent .el-input-number__increase {\n  width: 14px;\n}\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}